<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>雪花</title>
    <style>
        * {
            margin: 0; 
            padding: 0;
        }

        body {
            /* filter: invert(); */
            /* background: url(images/bg.jpg) center center no-repeat; */
            /* background-size: cover; */
            overflow: hidden;
            user-select: none;
        }

        input,
        #img,
        #fps {
            width: 10%;
            height: 10vh;
            position: absolute;
            z-index: 999;
        }

        input {
            margin: 1% 3%;
            filter: opacity(.2);
        }

        #img {
            display: none;
            margin: 6% 3%;
        }

        #fps {
            overflow: hidden;
            margin: 14% 3%;
            line-height: 10vh;
            text-align: center;
            color: rgba(0, 255, 0, .8);
            background-color: rgba(0, 0, 0, .5);
        }

        #canvas {
            display: block;
            z-index: -1;
        }
    </style>
    <script>
        window.onload = () => {
            var con = document.getElementById("canvas");
            var ctx = con.getContext("2d");
            var w = con.width = window.innerWidth;
            var h = con.height = window.innerHeight;

            setWH = () => {
                (navigator.platform == "Win32" || navigator.platform == "Win64") ? (w = con.width = window.innerWidth,h = con.height = window.innerHeight) : (w = con.width = 1400,h = con.height = 800);
            }

            window.onresize = () => {
                setWH();
                fps.style.fontSize = fps.clientWidth * .1 + "px";
            }

            var max = 6, min = 5, status = true;
            var inp = document.getElementsByTagName("input")[0];
            inp.addEventListener("change", () => {
                max = Number(inp.value);
                min = max - 1;
                status = (max < 6) ? false : (max > 6) ? true : status;
            });
            setInterval(() => {
                (status = ((max == 2) ? true : (max == 10) ? false : status)) ? (max += 1, inp.value = max, min = max - 1) : (max -= 1, inp.value = max, min = max - 1);
            }, 1000);

            var screen = document.getElementById("img");
            var fps = document.getElementById("fps");
            fps.style.fontSize = fps.clientWidth * .1 + "px";
            var a = document.createElement("a");
            var event = new MouseEvent("click");
            document.onkeydown = (e) => {
                (e.ctrlKey == true && e.altKey == true && e.keyCode == 68) ? (inp.style.display = "none", screen.style.display = "none", fps.style.display = "none") : (e.ctrlKey == true && e.altKey == true && e.keyCode == 83) ? (screen.src = con.toDataURL(), a = document.createElement("a"), event = new MouseEvent("click"), a.download = "", a.href = screen.src, a.dispatchEvent(event), inp.style.display = "block", screen.style.display = "block", fps.style.display = "block") : null;
            }

            var FPS = 0;
            setInterval(() => {
                fps.innerText = "FPS:" + FPS;
                FPS = 0;
            }, 1000);

            var snowCount = 50;
            snowCount = (navigator.platform == "Win32" || navigator.platform == "Win64") ? 1500 : 500;
            var snowArr = [];
            var img = new Image();
            img.src = "images/snow.png";

            class Snow_Z_0 {
                // x;
                // y;
                // vx;
                // vy;
                // h;
                // wh;
                // rx;
                // ry;
                d = null;
                init() {
                    this.x = Math.random() * w;
                    this.y = 0;
                    this.vx = Math.random() * (2 - 1) + 1;
                    this.vy = Math.random() * (max * 0.95 - min * 0.8) + min;
                    this.h = Math.random() * (h * 0.95 - h * 0.8) + h * 0.9;
                    this.wh = Math.random() * 15 + 10;
                }
                draw() {
                    ctx.drawImage(img, this.x, this.y, this.wh, this.wh);
                    this.update();
                }
                update() {
                    this.y < this.h ? this.y += this.vy : this.init();
                }
            }

            class Snow_Z_1 extends Snow_Z_0 {
                d = true;
                update() {
                    (this.y < this.h && this.x >= 0 && this.x <= w) ? (this.x += this.vx, this.y += this.vy) : this.init(); 
                }
            }

            class Snow_Z_2 extends Snow_Z_1 {
                d = false;
                update() {
                    (this.y < this.h && this.x >= 0 && this.x <= w) ? (this.x -= this.vx, this.y += this.vy) : this.init();
                }
            }

            function reset() {
                for (let i = 0; i < snowCount; i++) {
                    (function (a) {
                        setTimeout(() => {
                            for (let i = 0; i < 3; i++) {
                                let temp = eval("new Snow_Z_" + i + "()");
                                temp.init();
                                snowArr.push(temp);
                                // console.info(temp);
                            }
                        }, i * 200);
                    }(i))
                }
            }

            var bgImg = new Image();
            bgImg.src = "images/bg.jpg";
            bgImg.onload = ((bgImg) => {
                return () => {
                    ctx.drawImage(bgImg, 0, 0, w, h);
                }
            })(bgImg)

            function move() {
                ctx.clearRect(0, 0, w, h);
                ctx.fillStyle = "transparent";
                ctx.fillRect(0, 0, w, h);
                ctx.drawImage(bgImg, 0, 0, w, h);
                snowArr.forEach(items => {
                    items.draw();
                });
                FPS += 1;
                requestAnimationFrame(move);
            }

            reset();
            move();
        }
    </script>
</head>

<body>
    <input type="range" max="10" min="2" value="6">
    <img src="" alt="截图" id="img">
    <div id="fps"></div>
    <canvas id="canvas"></canvas>
</body>

</html>